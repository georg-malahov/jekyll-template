angular.module("app",["ui.slider","ui.grid","ui.grid.edit","ui.grid.autoResize","ui.grid.resizeColumns","ui.grid.moveColumns","ui.grid.saveState","ui.grid.selection","ui.grid.exporter","ui.grid.pinning","ui.bootstrap"]).config(["$interpolateProvider",function(e){return e.startSymbol("[["),e.endSymbol("]]")}]).run(["$rootScope",function(e){return e.preloading={page:!0}}]),angular.module("app").controller("MainController",["$scope","$rootScope","$modal","$window","$http","$q",function(e,t,i,n,r,o){return t.preloading.page=!1,e.openModal=function(l,a){var s,d;switch(a){case"create":case"edit":d=i.open({templateUrl:"modal.html",controller:"ModalController",size:l}),d.mode=a;break;case"segments":t.preloading.page=!0,s=o.defer(),r.get("pixel/"+t.editedPixel.id+"/affinity.json").success(function(e){return s.resolve(e)}).error(function(e){return s.resolve({status:"error",data:e})}),d=i.open({templateUrl:"modal__segments.html",controller:"ModalSegmentsController",size:l,resolve:{segments:function(){return s.promise}}})}return d.result.then(function(t){return e.result=t},function(){return angular.isDefined(n.__postedPixel)?(delete n.__postedPixel,t.editedPixel=!1):void 0})},n.__user&&(t.userName=n.__user.company+(n.__pixels.length+1)),n.__pixels.length||e.openModal("lg","create"),angular.isDefined(n.__postedPixel)?(t.editedPixel=n.__postedPixel,e.openModal("lg","edit")):void 0}]),angular.module("app").controller("ModalController",["$scope","$rootScope","$modalInstance","$window","$timeout",function(e,t,i,n,r){return e.customers=n.__customers,e.currencies=n.__currencies,e.mode=i.mode,e.modalTitle="Create new pixel",t.pixels={edit:{},create:{pixel_id:t.userName}},t.pixel=t.pixels[e.mode]||{},"edit"===e.mode&&(t.pixel=t.editedPixel,e.modalTitle="Edit '"+t.pixel.pixel_id+"' pixel"),e.defaultOption={"new":1,enabled:!0,customer:{type:"google_ddp",id:""},cpm:{currency:"USD",cost:""}},e.getDefaultOption=function(){var t;return t=angular.fromJson(angular.toJson(e.defaultOption))},e.pixelOptions=t.pixel.options||[],e.ok=function(){return i.close()},e.cancel=function(){return i.dismiss("cancel")},e.removeOption=function(i){return e.pixelOptions.splice(i,1),t.$broadcast("removeOption")},e.$watch("pixelOptions",function(e,i){var n;if(!(angular.equals(e,i)&&angular.isDefined(i)||e.length<2))return n=[],angular.forEach(e,function(e){return e.customer.unique=!~n.indexOf([e.customer.type,e.customer.id].join(".")),n.push([e.customer.type,e.customer.id].join("."))}),r(function(){return t.$broadcast("revalidateField","unique[]")},100)},!0)}]),angular.module("app").controller("ModalSegmentsController",["$scope","$rootScope","$modalInstance","segments",function(e,t,i,n){var r;return t.preloading.page=!1,e.modalTitle="Recommended Segments for '"+t.editedPixel.pixel_id+"' pixel",r="Unknown error occured when requesting segments!","success"===n.status?(e.segments=n.data,angular.isArray(n.data)&&!n.data.length&&(e.message="No recommended segments found")):e.message=n.message||r,e.ok=function(){return i.close()},e.cancel=function(){return i.dismiss("cancel")}}]),angular.module("app").controller("TableController",["$scope","$rootScope","$filter","$timeout","$interpolate","$window","ColumnsService",function(e,t,i,n,r,o,l){var a;return e.gridScope={},e.startSym=r.startSymbol(),e.endSym=r.endSymbol(),a="Select at least one pixel from the table.",e.editPixelTooltip=a,e.preloading.page=!1,e.gridOptions={saveScroll:!1,saveFilter:!1,saveFocus:!1,saveRowIdentity:!1,saveSelection:!1,enableGridMenu:!0,showGridFooter:!1,showColumnFooter:!1,multiSelect:!1,data:o.__pixels,columnDefs:l,onRegisterApi:function(i){var n;return e.gridApi=i,n=o.__pixels.length,50>=n?angular.element(document.getElementsByClassName("tablegrid_grid")[0]).css("height",30*n+45+"px"):angular.element(document.getElementsByClassName("tablegrid_grid")[0]).css("height","1545px"),i.selection.on.rowSelectionChanged(e,function(){var n;return n=i.selection.getSelectedGridRows(),void(n.length?(t.editedPixel=n[0].entity,e.editPixelTooltip=""):(t.editedPixel=!1,e.editPixelTooltip=a))})}}}]),angular.module("app").directive("tablecontrolPreview",["$rootScope","$timeout",function(e){return{restrict:"CA",link:function(t,i){var n;return i.popover({html:!0,container:"body",title:"Use these pixel code snippets",content:function(){var t,i,n;return n="",e.editedPixel&&(n=e.editedPixel.pixel_id),i='<script type="text/javascript">\n  (function (document) {\n    var iframe = document.createElement(\'iframe\'),\n      img = document.createElement("img");\n    iframe.width = "0";\n    iframe.height = "0";\n    iframe.frameBorder = "0";\n    iframe.style.position = "absolute";\n    iframe.style.left = "-9999px";\n    iframe.onload = function () {\n      img.src="http://advombat.ru/0.gif?pid='+n+'";\n      iframe.contentDocument.body.appendChild(img);\n    };\n    document.body.appendChild(iframe);\n  })(window.document)\n</script>',t='<img src="http://advombat.ru/0.gif?pid='+n+'" style="position: absolute; left: -9999px;" />','<div style="width:500px;">\n  <h5><u>For websites</u> (should be inserted before closing &lt;/body&gt; tag):</h5>\n  <textarea class="form-control" readonly rows="16" onclick="this.focus();this.select()">'+i+'</textarea>\n  <h5><u>For banners</u>:</h5>\n  <textarea class="form-control" readonly rows="2" onclick="this.focus();this.select()">'+t+"</textarea>\n</div>"},trigger:"click"}),n=function(e){return jQuery(e.target).parents(".popover").length?void 0:i.popover("hide")},i.on("shown.bs.popover",function(){return jQuery("body").bind("click",n)}),i.on("hidden.bs.popover",function(){return jQuery("body").unbind("click")})}}}]),angular.module("app").directive("tablecontrolLookalike",["$rootScope","$compile","$http","$timeout",function(e,t,i,n){return{restrict:"CA",link:function(r,o){var l;return r.lookalikePercent=0,r.createLookalike=function(e,t){return i({url:"/pixel/"+t+"/lookalike/",method:"POST",data:jQuery.param({percent:e}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){return"success"===e.status?(window.location.reload(),r.lookalikeMessage=""):r.lookalikeMessage=e.message||"Sorry, some error occured! Please, try again."}).error(function(e){return r.lookalikeMessage=e.message||"Sorry, some error occured! Please, try again."})},o.popover({html:!0,container:"body",title:function(){return t("<span>Set your look-a-like audience based on '[[editedPixel.pixel_id]]' pixel!</span>")(e)},content:function(){var i;return i="",e.editedPixel&&(i=e.editedPixel.id),t('<div class="audience" style="width:791px;">\n  <p class="alert alert-success">\n    Size range is based on the total audience. Smaller audiences most closely match your source audience.\n    Creating a larger audience increases your potential reach, but reduces the level of similarity to your source.\n  </p>\n  <hr/>\n  <div class="audience-setter">\n    <div class="slider_wrapper">\n      <div class="slider_title slider_title__low">Reach</div>\n      <div class="slider_content">\n        <div ui-slider="{orientation: \'horizontal\', range: \'min\'}"  min="0" max="100" step="5" ng-model="lookalikePercent"></div>\n      </div>\n      <div class="slider_title slider_title__high">Similarity</div>\n    </div>\n    <hr/>\n    <div class="clearfix">\n      <div class="selected-size"><span class="selected-size-title">Selected value: </span><span class="selected-size-value">[[lookalikePercent]]%</span></div>\n      <div class="selected-btn">\n        <button class="btn btn-block btn-primary" ng-click="createLookalike(lookalikePercent, \''+i+'\')">Create new look-a-like audience</button>\n      </div>\n    </div>\n    <div class="lookalike-error" ng-show="lookalikeMessage">\n      <p class="alert alert-warning" ng-bind="lookalikeMessage"></p>\n    </div>\n  </div>\n</div>')(r)},placement:"bottom",trigger:"click"}),l=function(e){return jQuery(e.target).parents(".popover").length?void 0:o.popover("hide")},o.on("shown.bs.popover",function(){return n(function(){return r.$apply(function(){return r.lookalikeMessage=""})}),jQuery("body").bind("click",l)}),o.on("hidden.bs.popover",function(){return jQuery("body").unbind("click")})}}}]),angular.module("app").directive("body",[function(){return{restrict:"E",link:function(){return FormValidation.Validator.unique={validate:function(e,t){var i;return i=t.val(),i?"true"===i:!0}},FormValidation.Validator.server={validate:function(e,t,i){var n;return n=t.hasClass("ng-pristine"),{valid:!n,message:i.message}}}}}}]).directive("pixelCreateForm",["$rootScope","$timeout","$window",function(e,t,i){return{restrict:"CA",link:function(n,r){var o;return o=function(){return r.formValidation({framework:"bootstrap",icon:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},button:{selector:'[type="submit"]',disabled:""},fields:{id:{validators:{notEmpty:{message:"Pixel ID is required"},regexp:{regexp:/^[\d|\w|\-|\_]*$/i,message:'Pixel ID can consist of alphabetical and digital characters as well ad "-" and "_" symbols only'}}},name:{validators:{notEmpty:{message:"Pixel Name is required"},stringLength:{min:3,max:255,trim:!0,message:"Pixel Name must be more then 3 and less than 255 characters"}}},"unique[]":{excluded:!1,validators:{unique:{enabled:!0,message:"Not allowed to share to the same customer id of the same type"}}}}}).on("success.form.fv",function(){return e.pixel={}})},t(function(){return o(),angular.isDefined(i.__postedPixel)&&r.data("formValidation").validate(),jQuery(".sharing-options_add").click(function(){return t(function(){var e;return e=jQuery(".sharing-option").last().find(".form-control"),angular.forEach(e,function(e){return r.data("formValidation").addField(jQuery(e))})},100),jQuery('[type="submit"]').removeClass("disabled").removeAttr("disabled")})},100),n.$on("removeOption",function(){return jQuery('[type="submit"]').removeClass("disabled").removeAttr("disabled")}),e.$on("revalidateField",function(e,t){return r.formValidation("revalidateField",t),r.data("formValidation").validateField(t)})}}}]).directive("noEdit",["$timeout",function(e){return{restrict:"A",scope:{noEdit:"="},link:function(t,i){return t.noEdit?e(function(){var e,t,n,r;return r=i.outerWidth(),e=i.outerHeight(),t=i.position(),n=jQuery('<div class="no-edit_veil"></div>'),n.width(r).height(e).css({left:t.left,top:t.top}),i.parent().append(n)},200):void 0}}}]),angular.module("app").factory("ColumnsService",function(){return[{field:"pixel_id",displayName:"Pixel ID",cellClass:"to-left",headerCellClass:"to-left",minWidth:100,width:"*"},{field:"status",displayName:"Status",cellClass:"to-left",headerCellClass:"to-left",minWidth:100,width:"*"},{field:"type",displayName:"Type",cellClass:"to-left",headerCellClass:"to-left",minWidth:100,width:"*"},{field:"name",displayName:"Name",cellClass:"to-left",headerCellClass:"to-left",minWidth:100,width:"*"},{field:"size",displayName:"Size",cellClass:"to-right",headerCellClass:"center",cellFilter:"number",minWidth:100},{field:"updated",displayName:"Updated",cellClass:"center",headerCellClass:"center",cellFilter:'date : "yyyy-MM-dd HH:mm"',minWidth:100},{field:"created",displayName:"Created",cellClass:"center",headerCellClass:"center",cellFilter:'date : "yyyy-MM-dd HH:mm"',minWidth:100}]}),angular.bootstrap(document,["app"]);